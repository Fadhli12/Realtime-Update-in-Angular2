<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Realtime Update in Angular2 by NamitaMalik</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Realtime Update in Angular2</h1>
      <h2 class="project-tagline">This blog discusses realtime update in Angular2</h2>
      <a href="https://github.com/NamitaMalik/Realtime-Update-in-Angular2" class="btn">View on GitHub</a>
      <a href="https://github.com/NamitaMalik/Realtime-Update-in-Angular2/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/NamitaMalik/Realtime-Update-in-Angular2/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="realtime-update-in-angular2" class="anchor" href="#realtime-update-in-angular2" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Realtime Update in Angular2</h1>

<p>Many a time we encounter a situation when we need to update our view <strong>real time</strong>. By <strong>real time</strong> I mean that as soon as a component changes the value of a particular variable,
all other components should get the updated value.</p>

<p>Let's get deeper into it by the simple example. In of my earlier <a href="https://namitamalik.github.io/">blogs</a> on <a href="https://namitamalik.github.io/Services-in-Angular2/"><strong>Services in Angular2</strong></a>, 
we had taken an example of a cinema ticket booking scenario where we had:</p>

<ol>
<li>
<code>AppComponent</code> - Parent component of the entire application. Included 2 child components.</li>
<li>
<code>BookShowComponent</code> - Component used to make booking through web application e.g. bookshow.com.</li>
<li>
<code>WindowComponent</code> - Component accessed to make booking through cinema window.</li>
<li>
<code>BookingService</code> - A service accessed by both <code>WindowComponent</code> and <code>BookShowComponent</code> to get the number of tickets available.</li>
</ol>

<p>Above components were then joined together to make a simple <code>app</code>. Using this app a user was able to book movie ticket and after each booking, the available ticket count would get updated.
But, this small <code>app</code> had a serious flaw - <code>one component would not know that the other component has updated the ticket till a booking request was made</code>.</p>

<p>See below:</p>

<p><img src="https://raw.githubusercontent.com/NamitaMalik/Realtime-Update-in-Angular2/master/assets/Services_Blog.gif" alt="Services_Blog.gif"></p>

<p>Did you notice the following:</p>

<ol>
<li>Initially, total number of available tickets were 10.</li>
<li>On booking a ticket through cinema window, the number of available tickets became 9, while at bookshow.com, number of available tickets was still 10.</li>
<li>Similarly, after making a booking through bookshow.com, number of available tickets became 8 as correctly displayed on bookshow.com but cinema window still has the booking count as 9.</li>
</ol>

<p>To avoid such a situation, we need to do something so that both the components show data consistently. But how?</p>

<p>Well, it would not be wrong if I say, that <strong>Angular2</strong> has bought best of all the worlds together and the simple solution the above problem is <strong>Observables</strong>. We know that 
<strong>Observables</strong> are being heavily used in <strong>Angular2</strong> just as <strong>Promises</strong> in <strong>Angular 1.x</strong>. But unlike <strong>Promises</strong>, <strong>Observables</strong> have much bigger role to play. Being 
based on the <strong>Observer Pattern</strong> they involve much more than extracting <strong>success</strong> and <strong>error</strong>. So, let's see some other useful stuff that <strong>Observables</strong> can do for us.</p>

<p>If you look at the <a href="https://namitamalik.github.io/Services-in-Angular2/">Services in Angular2</a> blog, you will notice that our <code>booking-service.ts</code> looks like:</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> {Injectable} <span class="pl-k">from</span> <span class="pl-s">"@angular/core"</span>;
@Injectable()
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">BookingService</span> {
    <span class="pl-v">totalTicketCount</span>:<span class="pl-k">number</span> <span class="pl-k">=</span> <span class="pl-c1">10</span>;
}</pre></div>

<p>... and this is the place where we need to make the most important change i.e. making the <code>totalTicketCount</code> a <strong>subject</strong>.</p>

<p>Well, the above line put up a plethora of questions in front of us so let's try to answer each question one by one:</p>

<h4>
<a id="q-what-is-subject" class="anchor" href="#q-what-is-subject" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Q. What is Subject?</h4>

<p><strong>Ans:</strong> <strong>Subject</strong> is a class in <strong>RxJS</strong> library. It inherits both <strong>Observable</strong> and <strong>Observer</strong> therefore we can easily say that a <strong>subject</strong> is both <strong>observer</strong> and <strong>observable</strong>.
We know that <strong>observers</strong> subscribe to an <strong>observable</strong> and if <strong>subject</strong> is both <strong>observer</strong> and <strong>observable</strong> this means that there would be <strong>observers</strong> subscribing to it and 
also it subscribing to some other source. A <strong>subject</strong>  simply broadcasts values pushed to it, to all the <strong>subscribers</strong> subscribing to it. 
In real life, shopkeeper can be taken as an example of a Subject, A shopkeeper is both buyer and a seller. He buys products from a factory and sells products to his customers.</p>

<h4>
<a id="q-are-there-any-different-implementations-of-subject" class="anchor" href="#q-are-there-any-different-implementations-of-subject" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Q. Are there any different implementations of Subject?</h4>

<p><strong>Ans:</strong> There are basically 3 different implementation of <strong>Subject</strong> which provide different functionality and can be used on the basis of different use case:</p>

<ol>
<li>
<strong>ReplaySubject</strong> - Stores all the values that have been pushed. It emits all the items that were emitted by the source, to all the <strong>observers</strong> that <strong>subscribe</strong> to it.</li>
<li>
<strong>AsyncSubject</strong> - It stores the last value and emits it when the sequence is completed.</li>
<li>
<strong>BehaviorSubject</strong> - <strong>BehaviorSubject</strong> is similar to <strong>ReplaySubject</strong> but it stores only the last value published. Also another difference that distinguishes it from <strong>AsyncSubject</strong> and <strong>ReplaySubject</strong> is that it takes default value at the time of initialisation.
So an <strong>observer</strong> subscribing to <strong>BehaviorSubject</strong> would receive a value as soon as it subscribes to it.</li>
</ol>

<h4>
<a id="q-which-one-out-of-the-3-implementations-we-are-going-to-use-for-our-use-case" class="anchor" href="#q-which-one-out-of-the-3-implementations-we-are-going-to-use-for-our-use-case" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Q. Which one out of the 3 implementations, we are going to use for our use case?**</h4>

<p><strong>Ans:</strong> We are going to use <strong>BehaviorSubject</strong> for our case.</p>

<h4>
<a id="q-can-we-see-some-action-now" class="anchor" href="#q-can-we-see-some-action-now" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Q. Can we see some action now?**</h4>

<p><strong>Ans:</strong> Yes Sure, here we go . . . .</p>

<p>So, let's make <code>totalTicketCount</code> a <strong>BehaviorSubject</strong> as given below:</p>

<div class="highlight highlight-source-ts"><pre>totalTicketCount:<span class="pl-en">BehaviorSubject</span>&lt;<span class="pl-k">number</span>&gt; <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BehaviorSubject</span>&lt;<span class="pl-k">number</span>&gt;(<span class="pl-c1">10</span>);</pre></div>

<p>After making this tweak and importing <code>BehaviorSubject</code>, our <code>booking-service.ts</code> now looks as:</p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> { Injectable } <span class="pl-k">from</span> <span class="pl-s">'@angular/core'</span>;
<span class="pl-k">import</span> {BehaviorSubject} <span class="pl-k">from</span> <span class="pl-s">'rxjs/Rx'</span>;

@Injectable()
<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">BookingService</span> {
   <span class="pl-v">totalTicketCount</span>:<span class="pl-en">BehaviorSubject</span>&lt;<span class="pl-k">number</span>&gt; <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">BehaviorSubject</span>&lt;<span class="pl-k">number</span>&gt;(<span class="pl-c1">10</span>);

}</pre></div>

<p>Now, let's make some tweaks in our <code>book-show.component.ts</code> and <code>window.component.ts</code> and these should be:</p>

<ol>
<li>We first need to subscribe to our <code>totalTicketCount</code> subject so that we can start receiving values from it:</li>
</ol>

<div class="highlight highlight-source-ts"><pre>constructor(private _bookingService:BookingService) {
    <span class="pl-c1">this</span>._bookingService.totalTicketCount.subscribe(totalTicketCount <span class="pl-k">=&gt;</span> {
        <span class="pl-c1">this</span>.ticketCount <span class="pl-k">=</span> totalTicketCount
    });
}</pre></div>

<ol>
<li>Once a user makes a booking we need to update the <code>totalTicketCount</code>:</li>
</ol>

<div class="highlight highlight-source-ts"><pre>bookShow <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> {
    <span class="pl-k">let</span> <span class="pl-v">ticketCount</span> = <span class="pl-c1">this</span>.ticketCount <span class="pl-k">-</span> <span class="pl-c1">1</span>;
    <span class="pl-c1">this</span>._bookingService.totalTicketCount.next(ticketCount);
}</pre></div>

<p>We have updated the <code>totalTicketCount</code> by notifying the <code>observer</code> about the next value.</p>

<p>After doing the above tweaks in both <code>book-show.component.ts</code> and <code>window.component.ts</code>, they would look like:</p>

<p><strong>book-show.component.ts</strong></p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> {Component} <span class="pl-k">from</span> <span class="pl-s">'@angular/core'</span>;
<span class="pl-k">import</span> {BookingService} <span class="pl-k">from</span> <span class="pl-s">"../common/service/booking-service"</span>;

@Component({
    selector: <span class="pl-s">'book-show'</span>,
    template: <span class="pl-s">`</span>
<span class="pl-s">        &lt;div&gt;</span>
<span class="pl-s">            &lt;h1&gt;Welcome to bookshow.com&lt;/h1&gt;</span>
<span class="pl-s">            &lt;span&gt;Welcome User&lt;/span&gt;</span>
<span class="pl-s">            &lt;p&gt;Currently, Number of Tickets available are: {{ticketCount}}&lt;/p&gt;</span>
<span class="pl-s">            &lt;button (click)="bookShow()"&gt;Book Ticket&lt;/button&gt;</span>
<span class="pl-s">        &lt;/div&gt;</span>
<span class="pl-s">    `</span>
})

<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">BookShowComponent</span> {
    <span class="pl-v">ticketCount</span>:<span class="pl-k">number</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;

    <span class="pl-en">constructor</span>(<span class="pl-k">private</span> <span class="pl-v">_bookingService</span>:BookingService) {
        <span class="pl-c1">this</span>._bookingService.totalTicketCount.subscribe(totalTicketCount <span class="pl-k">=&gt;</span> {
            <span class="pl-c1">this</span>.ticketCount <span class="pl-k">=</span> totalTicketCount
        });
    }

    <span class="pl-v">bookShow</span> <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> {
        <span class="pl-k">let</span> <span class="pl-v">ticketCount</span> = <span class="pl-c1">this</span>.ticketCount <span class="pl-k">-</span> <span class="pl-c1">1</span>;
        <span class="pl-c1">this</span>._bookingService.totalTicketCount.next(ticketCount);
    }
}</pre></div>

<p><strong>window.component.ts</strong></p>

<div class="highlight highlight-source-ts"><pre><span class="pl-k">import</span> {Component} <span class="pl-k">from</span> <span class="pl-s">'@angular/core'</span>;
<span class="pl-k">import</span> {BookingService} <span class="pl-k">from</span> <span class="pl-s">"../common/service/booking-service"</span>;

@Component({
    selector: <span class="pl-s">'cinema-window'</span>,
    template: <span class="pl-s">`</span>
<span class="pl-s">    &lt;div&gt;</span>
<span class="pl-s">        &lt;h1&gt;ABC Cinemas&lt;/h1&gt;</span>
<span class="pl-s">        &lt;span&gt;Hello Admin&lt;/span&gt;</span>
<span class="pl-s">        &lt;p&gt;Currently, Number of Tickets available are: {{ticketCount}}&lt;/p&gt;</span>
<span class="pl-s">        &lt;button (click)="bookTicket()"&gt;Book Ticket&lt;/button&gt;</span>
<span class="pl-s">    &lt;/div&gt;</span>
<span class="pl-s">    `</span>
})

<span class="pl-k">export</span> <span class="pl-k">class</span> <span class="pl-en">WindowComponent</span> {
    <span class="pl-v">ticketCount</span>:<span class="pl-k">number</span> <span class="pl-k">=</span> <span class="pl-c1">0</span>;

    <span class="pl-en">constructor</span>(<span class="pl-k">private</span> <span class="pl-v">_bookingService</span>:BookingService) {
        <span class="pl-c1">this</span>._bookingService.totalTicketCount.subscribe(totalTicketCount <span class="pl-k">=&gt;</span> {
            <span class="pl-c1">this</span>.ticketCount <span class="pl-k">=</span> totalTicketCount
        });
    }

    <span class="pl-v">bookTicket</span> <span class="pl-k">=</span> () <span class="pl-k">=&gt;</span> {
        <span class="pl-c1">this</span>.ticketCount <span class="pl-k">=</span> <span class="pl-c1">this</span>.ticketCount <span class="pl-k">-</span> <span class="pl-c1">1</span>;
        <span class="pl-c1">this</span>._bookingService.totalTicketCount.next(<span class="pl-c1">this</span>.ticketCount);
    };
}</pre></div>

<p>After doing the above tweaks, we should now be able to see the available ticket count <strong>real-time</strong> as shown in below:</p>

<p><img src="https://raw.githubusercontent.com/NamitaMalik/Realtime-Update-in-Angular2/master/assets/Realtime_Blog.gif" alt="Realtime-Blog.gif"></p>

<blockquote>
<p>Note: This is a small demo app to show how to make real time client updates. In a real world app, one will have to get the updated data from the server by using things like socket connections(which is not the agenda of this blog).</p>
</blockquote>

<h2>
<a id="follow-me" class="anchor" href="#follow-me" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Follow Me</h2>

<p><a href="https://github.com/NamitaMalik">Github</a></p>

<p><a href="https://twitter.com/namita13_04">Twitter</a></p>

<p><a href="https://in.linkedin.com/in/namita-malik-a7885b23">LinkedIn</a></p>

<p><a href="https://namitamalik.github.io/">More Blogs By Me</a></p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/NamitaMalik/Realtime-Update-in-Angular2">Realtime Update in Angular2</a> is maintained by <a href="https://github.com/NamitaMalik">NamitaMalik</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
